<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Случайные топики и комментарии</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f8f9fa;
            text-align: center;
        }
        h1, h2 {
            color: #333;
        }
        .form-container, .topic-container {
            max-width: 600px;
            margin: 20px auto;
            background: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            text-align: left;
        }
        input, textarea, button {
            width: 100%;
            padding: 10px;
            margin: 10px 0;
            border: 1px solid #ccc;
            border-radius: 4px;
        }
        button {
            background-color: #007bff;
            color: #fff;
            border: none;
            cursor: pointer;
        }
        button:hover {
            background-color: #0056b3;
        }
        ul {
            list-style: none;
            padding: 0;
        }
        li {
            background: #fff;
            margin: 10px 0;
            padding: 10px;
            border-radius: 5px;
            border: 1px solid #ddd;
            position: relative;
        }
        .delete-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background: #e74c3c;
            color: white;
            border: none;
            border-radius: 3px;
            padding: 5px 10px;
            cursor: pointer;
        }
        .delete-btn:hover {
            background: #c0392b;
        }
    </style>
</head>
<body>
    <h1>Случайные Топики</h1>

    <div id="authContainer" class="form-container">
        <h2>Регистрация</h2>
        <input type="text" id="nickname" placeholder="Введите Никнейм" />
        <input type="email" id="registerEmail" placeholder="Введите Email" />
        <input type="password" id="registerPassword" placeholder="Введите Пароль" />
        <button id="registerButton">Зарегистрироваться</button>
        <p id="registerError" style="color: red;"></p>

        <h2>Вход</h2>
        <input type="email" id="loginEmail" placeholder="Введите Email" />
        <input type="password" id="loginPassword" placeholder="Введите Пароль" />
        <button id="loginButton">Войти</button>
        <p id="loginError" style="color: red;"></p>
    </div>

    <div id="mainContainer" class="topic-container" style="display: none;">
        <h2 id="currentTopic">Нажмите на кнопку для генерации топика</h2>
        <button id="generateTopic">Генерировать Топик</button>

        <h3>Оставьте комментарий</h3>
        <textarea id="commentInput" placeholder="Напишите комментарий..."></textarea>
        <button id="submitComment">Отправить</button>
        <ul id="commentsList"></ul>
        <button id="logoutButton">Выйти</button>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-app.js";
        import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-auth.js";
        import { getDatabase, ref, push, onValue, remove } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-database.js";

        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyBHqJnWtHQAyOEzLb8UXcPtepND1pMs53I",
            authDomain: "comments-6024f.firebaseapp.com",
            databaseURL: "https://comments-6024f-default-rtdb.firebaseio.com/",
            projectId: "comments-6024f",
            storageBucket: "comments-6024f.appspot.com",
            messagingSenderId: "816381498544",
            appId: "1:816381498544:web:27ba0250808854dddf5775"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const database = getDatabase(app);

        // Elements
        const authContainer = document.getElementById("authContainer");
        const mainContainer = document.getElementById("mainContainer");
        const registerEmail = document.getElementById("registerEmail");
        const registerPassword = document.getElementById("registerPassword");
        const nickname = document.getElementById("nickname");
        const registerButton = document.getElementById("registerButton");
        const registerError = document.getElementById("registerError");

        const loginEmail = document.getElementById("loginEmail");
        const loginPassword = document.getElementById("loginPassword");
        const loginButton = document.getElementById("loginButton");
        const loginError = document.getElementById("loginError");

        const logoutButton = document.getElementById("logoutButton");
        const generateTopicButton = document.getElementById("generateTopic");
        const currentTopic = document.getElementById("currentTopic");
        const commentInput = document.getElementById("commentInput");
        const submitComment = document.getElementById("submitComment");
        const commentsList = document.getElementById("commentsList");

        const topics = [
            "Как прошёл твой день?",
            "Самое смешное, что случилось с тобой за последний год?",
            "Какой предмет в школе ты ненавидишь?",
            "Куда бы ты хотел отправиться в путешествие?",
            "Какое твоё любимое блюдо?",
            "Расскажи о своём самом странном сне.",
            "Что для тебя важнее всего в жизни?",
            "Какой фильм или сериал ты пересматривал больше всего?",
            "Кем ты мечтал стать в детстве?",
            "Что ты больше всего любишь делать в свободное время?",
            "Какая песня тебя вдохновляет?",
            "Какую суперспособность ты хотел бы иметь?",
            "Если бы ты выиграл миллион, на что бы его потратил?",
            "Какой день из жизни ты бы хотел пережить заново?",
            "Что ты никогда не попробуешь в жизни?"
        ];

        // Регистрация
        registerButton.addEventListener("click", () => {
            const email = registerEmail.value;
            const password = registerPassword.value;
            const nick = nickname.value;

            if (!nick) {
                registerError.textContent = "Введите никнейм!";
                return;
            }

            createUserWithEmailAndPassword(auth, email, password)
                .then((userCredential) => {
                    const user = userCredential.user;
                    push(ref(database, `users/${user.uid}`), { nickname: nick });
                    registerError.textContent = "";
                })
                .catch((error) => {
                    registerError.textContent = error.message;
                });
        });

        // Вход
        loginButton.addEventListener("click", () => {
            const email = loginEmail.value;
            const password = loginPassword.value;

            signInWithEmailAndPassword(auth, email, password)
                .then(() => {
                    loginError.textContent = "";
                })
                .catch((error) => {
                    loginError.textContent = error.message;
                });
        });

        // Генерация случайного топика
        generateTopicButton.addEventListener("click", () => {
            const randomIndex = Math.floor(Math.random() * topics.length);
            currentTopic.textContent = topics[randomIndex];
            commentsList.innerHTML = ""; // Очищаем список комментариев для нового топика
        });

        // Добавление комментария
        submitComment.addEventListener("click", () => {
            const comment = commentInput.value;
            const topic = currentTopic.textContent;

            if (!comment || topic === "Нажмите на кнопку для генерации топика") {
                alert("Сначала выберите топик и напишите комментарий!");
                return;
            }

            const commentsRef = ref(database, `topics/${topic}`);
            push(commentsRef, {
                text: comment,
                userId: auth.currentUser.uid,
                timestamp: Date.now()
            });
            commentInput.value = "";
        });

        // Выход
        logoutButton.addEventListener("click", () => {
            signOut(auth).catch((error) => console.error("Ошибка выхода:", error));
        });

        // Проверка авторизации
        onAuthStateChanged(auth, (user) => {
            if (user) {
                authContainer.style.display = "none";
                mainContainer.style.display = "block";
            } else {
                authContainer.style.display = "block";
                mainContainer.style.display = "none";
            }
        });
    </script>
</body>
</html>
